<!doctype html>
<html lang="en">

<head>
    <%- include('../partials/head'); %>
        <title>Document</title>
        <%- include('../partials/styles'); %>
            <link rel="stylesheet" href="../css/calificaciones.css">
</head>

<body>
    <%- include('../partials/nav-bar'); %><!--Arriba-->



        <div id="contenedor">
            <div id="nav1">
                <!--<h1>Color Guinda</h1>-->
            </div>
            <!--HEADER-->
            <header>
                <!--Navegación-->
                <a href="/" class="logo" target="blank"><img src="../img/Biblioteca-logo.jpg" alt="Logo"></a>
                <div class="navegacion">
                    <ul>
                        <li><a href="/">INICIO</a></li>
                        <li class="submenu">
                            <a href="#">alumnos</a>
                            <ul class="hijos">
                                <li><a href="/Alumnos">Ver alumnos</a></li>
                                <li><a href="/Alumnos/crear">Crear Alumno</a></li>
                            </ul>
                        </li>
                        <li class="submenu">
                            <a href="#">MATERIAS</a>
                            <ul class="hijos">
                                <li><a href="/Materias">Ver materias</a></li>
                                <li><a href="/Materias/1/Cuatrimestres">Materias cuatrimestre</a></li>
                                <li><a href="/Materias/Crear">Crear Materia</a></li>

                            </ul>
                        </li>
                        <li class="submenu">
                            <a href="#">CALIFICACIONES</a>
                            <ul class="hijos">
                                <li><a href="/Calificaciones/Estudiantes">Calificar alumno</a></li>
                                <li><a href="/Calificaciones/Historial/Estudiantes">Historial alumno</a></li>
                                <li><a href="/Calificaciones/Consultar/Estudiantes">Consulta alumno</a></li>
                                <li><a href="/Calificaciones/Resumen/Estudiantes/1">Resumen por cuatrimestre</a></li>

                            </ul>
                        </li>
                        <li><a href="/"></a></li>
                        <li><a href="/"></a></li>

                    </ul>
                </div>
            </header>

            <div id="menu-izq">
                <!--NAVEGACIón-->
                <div class="toggle-btn">
                    <span>&#9776</span>
                </div>
                <ul>
                    <li>
                        <img src="../img/Biblioteca-logo.jpg" alt="" class="logo">
                    </li>
                    <li><a href="#">HOME</a></li>
                    <li><a href="#">USUARIOS</a></li>
                    <li><a href="#">LIBROS</a></li>
                    <li><a href="#">PRESTAMOS</a></li>
                    <li><a href="#">EDITORIALES</a></li>
                    <li><a href="#">Autores</a></li>
                    <li> <a href="#">Consultas</a></li>
                </ul>
            </div>
            <div id="titulo">
                <h1>CONTROL GRUPAL</h1>
            </div>
            <div id="aside-der">
                <div id="titulo-der">
                    <h1>CALIFICAR ALUMNOS:</h1>
                </div>
                <div class="galeria">
                    <main>
                        <div class="container-fluid px-4">

                            <div class="card m-4">

                                <div class="card-body">

                                    <form action="/Calificaciones/Estudiantes" method="post">
                                        <div class="row m-3">
                                            <div class="col-md-4">
                                                <label>Seleccionar cuatrimestre</label>
                                            </div>
                                            <div class="col-md-8">
                                                <select name="cuatrimestre" id="cuatrimestre_select"
                                                    class="form-select">
                                                    <option value="7" <%=(cuatrimestre==7) ? 'selected' : '' %>>7
                                                    </option>
                                                    <option value="8" <%=(cuatrimestre==8) ? 'selected' : '' %>>8
                                                    </option>
                                                    <option value="9" <%=(cuatrimestre==9) ? 'selected' : '' %>>9
                                                    </option>
                                                    <option value="10" <%=(cuatrimestre==10) ? 'selected' : '' %>>10
                                                    </option>

                                                </select>
                                            </div>
                                        </div>
                                        <div class="row m-3">
                                            <div class="col-md-4">
                                                <label>Seleccionar Materia</label>
                                            </div>
                                            <div class="col-md-8">
                                                <select name="materia" id="materias_select" class="form-select">
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row m-3">
                                            <div class="col-md-4">
                                                <label>Seleccionar Parcial</label>
                                            </div>
                                            <div class="col-md-8">
                                                <select name="parcial" id="parcial_select" class="form-select">

                                                    <option value="1">Parcial 1</option>
                                                    <option value="2">Parcial 2</option>
                                                    <option value="3">Parcial 3</option>
                                                    <option value="4">Extraordinario</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row m-3">
                                            <div class="table-responsive-md ">
                                                <table class="table table-striped table-bordered">
                                                    <thead class="table-dark text-center">
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Matricula</th>
                                                            <th>Nombre</th>
                                                            <th>Apellido Paterno</th>
                                                            <th>Apellido Materno</th>
                                                            <th>Calificación</th>
                                                        </tr>
                                                    </thead>

                                                    <tbody class="table-light text-center">

                                                        <% if (alumnos) { %>
                                                            <% for (let i=0; i < alumnos.length; i++) { %>
                                                                <% alumno=alumnos[i] %>
                                                                    <tr>
                                                                        <td>
                                                                            <%= alumno.id %>
                                                                        </td>

                                                                        <td>
                                                                            <%= alumno.matricula %>
                                                                        </td>
                                                                        <td>
                                                                            <%= alumno.nombre %>
                                                                        </td>
                                                                        <td>
                                                                            <%= alumno.apellido_paterno %>
                                                                        </td>
                                                                        <td>
                                                                            <%= alumno.apellido_materno %>
                                                                        </td>
                                                                        <td>
                                                                            <div class="row">
                                                                                <div class="col-md-12">
                                                                                    <input type="hidden" name="alumno[]"
                                                                                        value="<%=alumno.id%>">
                                                                                    <input min="0" type="number"
                                                                                        name="calificacion[]"
                                                                                        class="form-control"
                                                                                        placeholder="calificar: 10,9,8"
                                                                                        required>
                                                                                </div>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    <% } %>
                                                                        <% } %>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <div class="row m-3 text-center">
                                            <div class="col-md-6">
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fa fa-save"></i>
                                                    Guardar
                                                </button>
                                            </div>
                                            <div class="col-md-6">
                                                <a class="btn btn-danger" href="/">
                                                    <i class="fa fa-undo"></i>
                                                    Cancelar
                                                </a>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                            </div>


                        </div>
                    </main>
                </div>

            </div>
            <div id="pie-pag">

                <section>
                    <h1> © Geovanni Melchor Solano, todos los derechos revervados.</h1>
                </section>

            </div>
        </div>
        </div>

        <%- include('../partials/scripts'); %>

        <script>
        
            function rellenarSelectMaterias(opciones) {
                const $select = $('#materias_select'); // Obtén el elemento select por su ID
                $select.empty();
                // Recorre el array de opciones y agrega cada una al select
                opciones.forEach(opcion => {
                    const $option = $('<option>', {
                        value: opcion.value,
                        text: opcion.text
                    });
                    $select.append($option);
                });
            }
            function buscarMaterias(cuatrimestre) {
                $.post('/Materias/ByCuatrimestres', {
                        cuatrimestre
                    },
                    function (resp) {
                        const opciones  = resp.data.map(function(materia) {
                            return {
                                value: materia.id,
                                text: materia.clave_materia + ' - ' + materia.nombre
                            };
                        });
                        console.log(opciones)
                        rellenarSelectMaterias(opciones);
                    },
                    'json'
                );
            }
        
            $(document).ready(function() {
        
        
                $('#cuatrimestre_select').change(function () {
                    const cuatrimestre  =   +$('#cuatrimestre_select').val();
        
                  buscarMaterias(cuatrimestre);
                });
        
                buscarMaterias(1);
            });
        </script>


</body>

</html>